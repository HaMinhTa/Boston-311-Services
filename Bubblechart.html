<!DOCTYPE html>
<meta charset="utf-8">
<style>

.links line {
  stroke: #999;
  stroke-opacity: 0.6;
}

.nodes circle {
  stroke: #fff;
  stroke-width: 1.5px;
}

</style>
<button id="btn">Click Here</button>
<svg width="960" height="600"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

btn = document.getElementById("btn");
btn.onclick = function() {
  console.log("Here");
  simulation.force("center_force", d3.forceX().x(function(d) {
    console.log("Here too");
    if (d["year"] === 2012) { return 100; }
    else                    { return 900; }
  }));
}

var svg = d3.select("svg"),
 width = +svg.attr("width"),
 height = +svg.attr("height");

var node_data = [
  {"reason": "Sanitation", "number": 27208, "year": 2012},
  {"reason": "Highway Maintenance", "number": 23303, "year": 2012},
  {"reason": "Street Lights", "number": 10318, "year": 2012},
  {"reason": "Street Cleaning", "number": 9967, "year": 2012},
  {"reason": "Housing", "number": 7251, "year": 2012},
  {"reason": "Trees", "number": 6369, "year": 2012},
  {"reason": "Sanitation", "number": 15196, "year": 2018},
  {"reason": "Highway Maintenance", "number": 15212, "year": 2018},
  {"reason": "Street Lights", "number": 5156, "year": 2018},
  {"reason": "Street Cleaning", "number": 19311, "year": 2018},
  {"reason": "Housing", "number": 3607, "year": 2018},
  {"reason": "Trees", "number": 7865, "year": 2018}
  // {"reason": "Signs & Signal", "number": 6340, "number": 4285},
  // {"reason": "Recycling", "number": 5202, "number": 1179},
  // {"reason": "Grafiti", "number": 3985, "number": 4022},
  // {"reason": "Recycling", "number": 3892, "number": 1770}
];

function getRadius(d) {
  return d["number"] / 400;
}

function translateCircle(d) {
  return `translate(${d.x}, ${d.y})`
}


var simulation = d3.forceSimulation()
                   .nodes(node_data)
                   .force("charge_force", d3.forceManyBody().strength(15))
                   .force("center_force", d3.forceCenter(width / 2, height / 2))
                   .force("collide", d3.forceCollide().radius(getRadius))
                   .on("tick", tickActions);

var node = svg.append("g")
              .attr("class", "nodes")
              .selectAll("circle")
              .data(node_data)
              .enter()
              .append("circle")
              .attr("r", getRadius)
              .attr("fill", function(d) {
                if (d["year"] === 2012) { return "red"; }
                else                    { return "green"; }
              })
              .on("mouseover", function(d,i) {
                d3.select(this).attr("fill","grey")
                tooltip.transition().duration(100)
                tooltip.html(`<b>Reason</b>: ${d.reason}.<br> <b>Number of Calls</b>: ${d.number}`)
                .style("left", d3.event.pageX + 50 + "px")
                .style("top", d3.event.pageY + 50 + "px")
                .style("opacity", 1)
                .style("padding", "8px 10px")
                .style("border-radius", "5px");
              })
              .on("mouseout", function() {
                d3.select(this).attr("fill",function(d) {
                  if (d["year"] === 2012) { return "red"; }
                  else                    { return "green"; }
                })
                tooltip.html("")
                .style("padding", "0");
              });

function tickActions() {
    node.attr("transform", translateCircle);
  }

var tooltip = d3.select("body")
  .append("div")
  .attr("class", "tooltip")
  .style("position", "absolute")
  .style("background", "#b3f0ff");

</script>
