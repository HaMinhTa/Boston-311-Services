<!DOCTYPE html>
<meta charset="utf-8">
<style>

.links line {
  stroke: #999;
  stroke-opacity: 0.6;
}

.nodes circle {
  stroke: #fff;
  stroke-width: 0.5px;
}

</style>
<svg width="960" height="600"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var svg = d3.select("svg"),
 width = +svg.attr("width"),
 height = +svg.attr("height");

var node_data = [
  {"reason": "Sanitation", "number": 27208, "year": 2012},
  {"reason": "Highway Maintenance", "number": 23303, "year": 2012},
  {"reason": "Street Lights", "number": 10318, "year": 2012},
  {"reason": "Street Cleaning", "number": 9967, "year": 2012},
  {"reason": "Housing", "number": 7251, "year": 2012},
  {"reason": "Trees", "number": 6369, "year": 2012},
  {"reason": "Signs & Signals", "number": 6340, "year": 2012},
  {"reason": "Recycling", "number": 5202, "year": 2012},
  {"reason": "Graffiti", "number": 3985, "year": 2012},
  {"reason": "Building", "number": 3892, "year": 2012},
  {"reason": "Environmental Services", "number": 3027, "year": 2012},
  {"reason": "Employee & General Comments", "number": 3012, "year": 2012},
  {"reason": "Enforcement & Abandoned Vehicles", "number": 2569, "year": 2012},
  //{"reason": "Administrative & General Requests", "number": 0, "year": 2012},
  {"reason": "Notification", "number": 971, "year": 2012},
  {"reason": "Health", "number": 800, "year": 2012},

  //{"reason": "Park Maintenance & Safety", "number": 518, "year": 2012},
  //{"reason": "Programs", "number": 392, "year": 2012},
  //{"reason": "Catchbasin", "number": 345, "year": 2012},
  //{"reason": "General Request", "number": 219, "year": 2012},
  //{"reason": "Operations", "number": 217, "year": 2012},
  //{"reason": "Traffic Management & Engineering", "number": 170, "year": 2012},
  //{"reason": "Sidewalk Cover / Manhole", "number": 157, "year": 2012},
  //{"reason": "Abandoned Bicycle", "number": 128, "year": 2012},
  //{"reason": "Fire Hydrantn", "number": 113, "year": 2012},
  //{"reason": "Weights and Measures", "number": 81, "year": 2012},
  //{"reason": "Volunteer & Corporate Groups", "number": 49, "year": 2012},
  //{"reason": "Water Issues", "number": 28, "year": 2012},
  //{"reason": "Cemetery", "number": 26, "year": 2012},
  //{"reason": "Bridge Maintenance", "number": 25, "year": 2012},
  //{"reason": "Pothole", "number": 19, "year": 2012},
  //{"reason": "Code Enforcement", "number": 16, "year": 2012},
  //{"reason": "Parking Complaints", "number": 14, "year": 2012},
  //{"reason": "Billing", "number": 13, "year": 2012},
  //{"reason": "Office of The Parking Clerk", "number": 9, "year": 2012},
  //{"reason": "Alert Boston", "number": 8, "year": 2012},
  //{"reason": "Valet", "number": 5, "year": 2012},
  //{"reason": "MBTA", "number": 2, "year": 2012},
  //{"reason": "Current Events", "number": 1, "year": 2012},

  {"reason": "Sanitation", "number": 15196, "year": 2018},
  {"reason": "Highway Maintenance", "number": 15212, "year": 2018},
  {"reason": "Street Lights", "number": 5156, "year": 2018},
  {"reason": "Street Cleaning", "number": 18311, "year": 2018},
  {"reason": "Housing", "number": 3607, "year": 2018},
  {"reason": "Trees", "number": 4634, "year": 2018},

  {"reason": "Signs & Signals", "number": 7865, "year": 2018},
  {"reason": "Recycling", "number": 4285, "year": 2018},
  {"reason": "Graffiti", "number": 1779, "year": 2018},
  {"reason": "Building", "number": 4022, "year": 2018},
  {"reason": "Environmental Services", "number": 1770, "year": 2018},
  {"reason": "Employee & General Comments", "number": 1572, "year": 2018},
  {"reason": "Enforcement & Abandoned Vehicles", "number": 22293, "year": 2018},
  {"reason": "Administrative & General Requests", "number": 876, "year": 2018},
  //{"reason": "Notification", "number": 340, "year": 2018},
  //{"reason": "Health", "number": 620, "year": 2018},
  {"reason": "Park Maintenance & Safety", "number": 3190, "year": 2018},
  //{"reason": "Programs", "number": 28, "year": 2018},
  //{"reason": "Catchbasin", "number": 339, "year": 2018},
  //{"reason": "General Request", "number": 59, "year": 2018},
  //{"reason": "Operations", "number": 190, "year": 2018},
  //{"reason": "Traffic Management & Engineering", "number": 431, "year": 2018},
  //{"reason": "Sidewalk Cover / Manhole", "number": 177, "year": 2018},
  //{"reason": "Abandoned Bicycle", "number": 673, "year": 2018},
  //{"reason": "Fire Hydrantn", "number": 137, "year": 2018},
  //{"reason": "Weights and Measures", "number": 32, "year": 2018},
  //{"reason": "Volunteer & Corporate Groups", "number": 0, "year": 2018},
  //{"reason": "Water Issues", "number": 0, "year": 2018},
  //{"reason": "Cemetery", "number": 12, "year": 2018},
  //{"reason": "Bridge Maintenance", "number": 1, "year": 2018},
  //{"reason": "Pothole", "number": 29, "year": 2018},
  {"reason": "Code Enforcement", "number": 14983, "year": 2018},
  //{"reason": "Parking Complaints", "number": 5, "year": 2018},
  //{"reason": "Billing", "number": 4, "year": 2018},
  //{"reason": "Office of The Parking Clerk", "number": 6, "year": 2018},
  //{"reason": "Alert Boston", "number": 29, "year": 2018},
  //{"reason": "Valet", "number": 4, "year": 2018},
  //{"reason": "MBTA", "number": 0, "year": 2018},
  //{"reason": "Current Events", "number": 7, "year": 2018},

  //{"reason": "Air Pollution Control", "number": 29, "year": 2018},
  {"reason": "Aminal Issues", "number": 1476, "year": 2018},
  //{"reason": "Boston Bikes", "number": 33, "year": 2018},
  //{"reason": "Consumer Affairs Issues", "number": 19, "year": 2018},
  //{"reason": "Fire Department", "number": 9, "year": 2018},
  //{"reason": "Generic Noise Disturbance", "number": 47, "year": 2018},
  //{"reason": "Massport", "number": 9, "year": 2018},
  {"reason": "Needle Program", "number": 2276, "year": 2018},
  //{"reason": "Neighborhood Services Issues", "number": 15, "year": 2018},
  //{"reason": "Noise Disturbance", "number": 108, "year": 2018},


];

function getRadius(d) {
  return d["number"] / 300;
}

function translateCircle(d) {
  return `translate(${d.x}, ${d.y})`
}


var simulation = d3.forceSimulation()
                   .nodes(node_data)
                   .force("charge_force", d3.forceManyBody().strength(15))
                   .force("center_force", d3.forceCenter(width / 2, height / 2))
                   .force("collide", d3.forceCollide().radius(getRadius))
                   .on("tick", tickActions);

var node = svg.append("g")
              .attr("class", "nodes")
              .selectAll("circle")
              .data(node_data)
              .enter()
              .append("circle")
              .attr("r", getRadius)
              .attr("fill", function(d) {
                if (d["year"] === 2012) { return "#00ccff"; }
                else                    { return "#ffbb33"; }
              })
              .on("mouseover", function(d,i) {
                d3.select(this).attr("fill","grey")
                tooltip.transition().duration(100)
                // there is a problem here with the tooltip
                tooltip.html(`<b>Reason</b>: ${d.reason}.<br> <b>Number of Calls</b>: ${d.number}`)
                .style("left", d3.event.pageX - 50 + "px")
                .style("top", d3.event.pageY - 50 + "px")
                .style("opacity", 1)
                .style("padding", "8px 10px")
                .style("border-radius", "5px");
              })
              .on("mouseout", function() {
                d3.select(this).attr("fill",function(d) {
                  if (d["year"] === 2012) { return "#00ccff"; }
                  else                    { return "#ffbb33"; }
                })
                tooltip.html("")
                .style("padding", "0");
              });

function tickActions() {
    node.attr("transform", translateCircle);
  }

var tooltip = d3.select("body")
  .append("div")
  .attr("class", "tooltip")
  .style("position", "absolute")
  .style("background", "#b3f0ff");

</script>
